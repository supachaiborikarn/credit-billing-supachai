import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// Comprehensive mapping of name variations to standard names
const NAME_MAPPINGS: Record<string, string> = {
    // à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸§à¸µà¸£à¸°à¸§à¸“à¸´à¸Šà¸¢à¹Œ
    'à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸§à¸µà¸£à¸°à¸§à¸“à¸´à¸Šà¸¢à¹Œ.': 'à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸§à¸µà¸£à¸°à¸§à¸“à¸´à¸Šà¸¢à¹Œ',
    'à¸šà¸ˆà¸.à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸§à¸µà¸£à¸°à¸§à¸“à¸´à¸Šà¸¢à¹Œ': 'à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸§à¸µà¸£à¸°à¸§à¸“à¸´à¸Šà¸¢à¹Œ',
    'à¸šà¸ˆà¸. à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸§à¸µà¸£à¸°à¸§à¸“à¸´à¸Šà¸¢à¹Œ': 'à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸§à¸µà¸£à¸°à¸§à¸“à¸´à¸Šà¸¢à¹Œ',
    'à¸«à¸ˆà¸.à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸§à¸µà¸£à¸°à¸§à¸“à¸´à¸Šà¸¢à¹Œ': 'à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸§à¸µà¸£à¸°à¸§à¸“à¸´à¸Šà¸¢à¹Œ',

    // à¸­à¸µà¸‹à¸¹à¸‹à¸¸à¹€à¸ªà¸™à¸µà¸¢à¹Œà¸¢à¸™à¸•à¹Œà¸™à¸„à¸£à¸ªà¸§à¸£à¸£à¸„à¹Œ
    'à¸šà¸ˆà¸.à¸­à¸µà¸‹à¸¹à¸‹à¸¸à¹€à¸ªà¸™à¸µà¸¢à¸™à¸•à¹Œà¸™à¸„à¸£à¸ªà¸§à¸£à¸£à¸„à¹Œ': 'à¸­à¸µà¸‹à¸¹à¸‹à¸¸à¹€à¸ªà¸™à¸µà¸¢à¹Œà¸¢à¸™à¸•à¹Œà¸™à¸„à¸£à¸ªà¸§à¸£à¸£à¸„à¹Œ',
    'à¸­à¸µà¸‹à¸¹à¸‹à¸¸à¹€à¸ªà¸™à¸µà¸¢à¸™à¸•à¹Œà¸™à¸„à¸£à¸ªà¸§à¸£à¸£à¸„à¹Œ': 'à¸­à¸µà¸‹à¸¹à¸‹à¸¸à¹€à¸ªà¸™à¸µà¸¢à¹Œà¸¢à¸™à¸•à¹Œà¸™à¸„à¸£à¸ªà¸§à¸£à¸£à¸„à¹Œ',
    'à¸š.à¸­à¸µà¸‹à¸¹à¸‹à¸¸à¹€à¸ªà¸™à¸µà¸¢à¸™à¸•à¹Œ': 'à¸­à¸µà¸‹à¸¹à¸‹à¸¸à¹€à¸ªà¸™à¸µà¸¢à¹Œà¸¢à¸™à¸•à¹Œà¸™à¸„à¸£à¸ªà¸§à¸£à¸£à¸„à¹Œ',
    'à¸šà¸ˆà¸.à¸­à¸µà¸‹à¸¹à¸‹à¸¸à¹€à¸ªà¸™à¸µà¸¢à¹Œà¸¢à¸™à¸•à¹Œà¸™à¸„à¸£à¸ªà¸§à¸£à¸£à¸„à¹Œ': 'à¸­à¸µà¸‹à¸¹à¸‹à¸¸à¹€à¸ªà¸™à¸µà¸¢à¹Œà¸¢à¸™à¸•à¹Œà¸™à¸„à¸£à¸ªà¸§à¸£à¸£à¸„à¹Œ',

    // à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¹à¸à¹Šà¸ª / à¹à¸à¹‡à¸ª
    'à¸«à¸ˆà¸.à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¹à¸à¹‡à¸ª': 'à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¹à¸à¹Šà¸ª',
    'à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¹à¸à¹‡à¸ª': 'à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¹à¸à¹Šà¸ª',

    // à¸à¸²à¸£à¹„à¸Ÿà¸Ÿà¹‰à¸²à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£
    'à¸à¸²à¸£à¹„à¸Ÿà¸Ÿà¹‰à¸² à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£': 'à¸à¸²à¸£à¹„à¸Ÿà¸Ÿà¹‰à¸²à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£',
    'à¹„à¸Ÿà¸Ÿà¹‰à¸²à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£': 'à¸à¸²à¸£à¹„à¸Ÿà¸Ÿà¹‰à¸²à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£',
    'à¸à¸Ÿà¸ .à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£': 'à¸à¸²à¸£à¹„à¸Ÿà¸Ÿà¹‰à¸²à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£',

    // à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸®à¸­à¸™à¸”à¹‰à¸²
    'à¸š.à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸®à¸­à¸™à¸”à¹‰à¸²(à¸£à¸–à¸¥à¸¹à¸à¸„à¹‰à¸²)': 'à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸®à¸­à¸™à¸”à¹‰à¸²',
    'à¸š. à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸®à¸­à¸™à¸”à¹‰à¸²(à¸£à¸–à¸¥à¸¹à¸à¸„à¹‰à¸²)': 'à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸®à¸­à¸™à¸”à¹‰à¸²',
    'à¸šà¸ˆà¸.à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸®à¸­à¸™à¸”à¹‰à¸² (à¸¥à¸¹à¸à¸„à¹‰à¸²)': 'à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸®à¸­à¸™à¸”à¹‰à¸²',
    'à¸š.à¸®à¸­à¸™à¸”à¹‰à¸²à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£(à¸¥à¸¹à¸à¸„à¹‰à¸²)': 'à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸®à¸­à¸™à¸”à¹‰à¸²',
    'à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸®à¸­à¸™à¸”à¹‰à¸²(à¸¥à¸¹à¸à¸„à¹‰à¸²)': 'à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸®à¸­à¸™à¸”à¹‰à¸²',
};

async function main() {
    console.log('='.repeat(60));
    console.log('ðŸ”§ à¹à¸à¹‰à¹„à¸‚à¸Šà¸·à¹ˆà¸­à¸‹à¹‰à¸³à¹ƒà¸™ Transaction à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”');
    console.log('='.repeat(60));
    console.log('');

    let totalUpdated = 0;
    const details: string[] = [];

    for (const [oldName, newName] of Object.entries(NAME_MAPPINGS)) {
        const result = await prisma.transaction.updateMany({
            where: { ownerName: oldName },
            data: { ownerName: newName }
        });

        if (result.count > 0) {
            console.log(`ðŸ“ "${oldName}" â†’ "${newName}": ${result.count} à¸£à¸²à¸¢à¸à¸²à¸£`);
            details.push(`${oldName} â†’ ${newName}: ${result.count}`);
            totalUpdated += result.count;
        }
    }

    console.log('\n' + '='.repeat(60));

    // Also find any remaining potential duplicates by checking for à¸šà¸ˆà¸., à¸«à¸ˆà¸., à¸š. prefixes
    console.log('\nðŸ“‹ à¸•à¸£à¸§à¸ˆà¸«à¸²à¸Šà¸·à¹ˆà¸­à¸—à¸µà¹ˆà¸­à¸²à¸ˆà¸‹à¹‰à¸³à¹€à¸žà¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡ (à¸¡à¸µ prefix à¸šà¸ˆà¸./à¸«à¸ˆà¸./à¸š.):');

    const allNames = await prisma.transaction.groupBy({
        by: ['ownerName'],
        _count: true,
        where: {
            ownerName: {
                startsWith: 'à¸š'
            }
        }
    });

    const potentialDuplicates = allNames.filter(n =>
        n.ownerName && (
            n.ownerName.startsWith('à¸šà¸ˆà¸.') ||
            n.ownerName.startsWith('à¸«à¸ˆà¸.') ||
            n.ownerName.startsWith('à¸š.') ||
            n.ownerName.endsWith('.')
        )
    );

    if (potentialDuplicates.length > 0) {
        console.log('âš ï¸ à¸žà¸šà¸Šà¸·à¹ˆà¸­à¸—à¸µà¹ˆà¸­à¸²à¸ˆà¸•à¹‰à¸­à¸‡à¹à¸à¹‰à¹„à¸‚à¹€à¸žà¸´à¹ˆà¸¡:');
        potentialDuplicates.forEach(p => {
            console.log(`   - ${p.ownerName} (${p._count} à¸£à¸²à¸¢à¸à¸²à¸£)`);
        });
    } else {
        console.log('   âœ… à¹„à¸¡à¹ˆà¸žà¸š');
    }

    console.log('\n' + '='.repeat(60));
    console.log(`âœ… à¸£à¸§à¸¡à¹à¸à¹‰à¹„à¸‚à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”: ${totalUpdated} à¸£à¸²à¸¢à¸à¸²à¸£`);
    console.log('='.repeat(60));
}

main()
    .catch((e) => {
        console.error('âŒ Error:', e);
        process.exit(1);
    })
    .finally(async () => {
        await prisma.$disconnect();
    });
