generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model audit_logs {
  id        String   @id
  userId    String
  action    String
  model     String
  recordId  String
  oldData   Json?
  newData   Json?
  ipAddress String?
  createdAt DateTime @default(now())
  users     users    @relation(fields: [userId], references: [id])
}

model daily_records {
  id             String            @id
  stationId      String
  date           DateTime
  retailPrice    Decimal           @default(31.34)
  wholesalePrice Decimal           @default(30.5)
  status         DailyRecordStatus @default(OPEN)
  createdAt      DateTime          @default(now())
  updatedAt      DateTime
  gasPrice       Decimal?
  stations       stations          @relation(fields: [stationId], references: [id])
  gauge_readings gauge_readings[]
  meter_readings meter_readings[]
  shifts         shifts[]
  transactions   transactions[]

  @@unique([stationId, date])
}

model gas_supplies {
  id            String   @id
  stationId     String
  date          DateTime
  liters        Decimal
  supplier      String?
  invoiceNo     String?
  pricePerLiter Decimal?
  totalCost     Decimal?
  notes         String?
  createdAt     DateTime @default(now())
  stations      stations @relation(fields: [stationId], references: [id])
}

model gauge_readings {
  id            String         @id
  stationId     String
  dailyRecordId String?
  date          DateTime
  percentage    Decimal
  photoUrl      String?
  recordedById  String?
  notes         String?
  createdAt     DateTime       @default(now())
  tankNumber    Int
  daily_records daily_records? @relation(fields: [dailyRecordId], references: [id])
}

model invoices {
  id            String         @id
  ownerId       String
  dueDate       DateTime?
  totalAmount   Decimal
  status        InvoiceStatus  @default(PENDING)
  paidAmount    Decimal        @default(0)
  notes         String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime
  invoiceNumber String         @unique
  owners        owners         @relation(fields: [ownerId], references: [id])
  payments      payments[]
  transactions  transactions[]
}

model meter_readings {
  id            String         @id
  dailyRecordId String?
  nozzleNumber  Int
  startReading  Decimal        @default(0)
  endReading    Decimal?
  startPhoto    String?
  endPhoto      String?
  shiftId       String?
  daily_records daily_records? @relation(fields: [dailyRecordId], references: [id])
  shifts        shifts?        @relation(fields: [shiftId], references: [id])

  @@unique([dailyRecordId, nozzleNumber])
  @@unique([shiftId, nozzleNumber])
}

model owners {
  id           String         @id
  name         String
  phone        String?
  venderCode   String?
  groupType    OwnerGroup     @default(GENERAL_CREDIT)
  code         String?
  createdAt    DateTime       @default(now())
  deletedAt    DateTime?
  invoices     invoices[]
  transactions transactions[]
  trucks       trucks[]
}

model payments {
  id            String   @id
  invoiceId     String
  amount        Decimal
  paymentDate   DateTime @default(now())
  paymentMethod String
  notes         String?
  createdAt     DateTime @default(now())
  invoices      invoices @relation(fields: [invoiceId], references: [id])
}

model product_inventories {
  id         String   @id
  productId  String
  stationId  String
  quantity   Int      @default(0)
  alertLevel Int?
  updatedAt  DateTime
  products   products @relation(fields: [productId], references: [id])
  stations   stations @relation(fields: [stationId], references: [id])

  @@unique([productId, stationId])
}

model product_receipts {
  id        String   @id
  productId String
  stationId String
  quantity  Int
  costPrice Decimal?
  supplier  String?
  invoiceNo String?
  date      DateTime @default(now())
  createdAt DateTime @default(now())
}

model product_sales {
  id          String      @id
  productId   String
  stationId   String
  quantity    Int
  salePrice   Decimal
  paymentType PaymentType
  date        DateTime    @default(now())
  createdAt   DateTime    @default(now())
  products    products    @relation(fields: [productId], references: [id])
}

model products {
  id                  String                @id
  name                String
  unit                String
  costPrice           Decimal?
  salePrice           Decimal
  createdAt           DateTime              @default(now())
  product_inventories product_inventories[]
  product_sales       product_sales[]
}

model sessions {
  id        String   @id
  userId    String
  createdAt DateTime @default(now())
  expiresAt DateTime
  users     users    @relation(fields: [userId], references: [id])
}

model settings {
  id        String   @id
  key       String   @unique
  value     String
  updatedAt DateTime
}

model shifts {
  id             String           @id
  dailyRecordId  String
  shiftNumber    Int
  staffId        String?
  status         String           @default("OPEN")
  createdAt      DateTime         @default(now())
  closedAt       DateTime?
  meter_readings meter_readings[]
  daily_records  daily_records    @relation(fields: [dailyRecordId], references: [id])
  users          users?           @relation(fields: [staffId], references: [id])

  @@unique([dailyRecordId, shiftNumber])
}

model stations {
  id                  String                @id
  name                String
  type                StationType
  gasPrice            Decimal?
  gasStockAlert       Decimal?
  hasProducts         Boolean               @default(false)
  daily_records       daily_records[]
  gas_supplies        gas_supplies[]
  product_inventories product_inventories[]
  transactions        transactions[]
  users               users[]
}

model transactions {
  id               String         @id
  stationId        String
  dailyRecordId    String?
  date             DateTime       @default(now())
  truckId          String?
  licensePlate     String?
  ownerId          String?
  ownerName        String?
  paymentType      PaymentType
  nozzleNumber     Int?
  liters           Decimal
  pricePerLiter    Decimal
  amount           Decimal
  productType      String?
  billBookNo       String?
  billNo           String?
  notes            String?
  recordedById     String
  invoiceId        String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime
  transferProofUrl String?
  deletedAt        DateTime?
  daily_records    daily_records? @relation(fields: [dailyRecordId], references: [id])
  invoices         invoices?      @relation(fields: [invoiceId], references: [id])
  owners           owners?        @relation(fields: [ownerId], references: [id])
  users            users          @relation(fields: [recordedById], references: [id])
  stations         stations       @relation(fields: [stationId], references: [id])
  trucks           trucks?        @relation(fields: [truckId], references: [id])
}

model trucks {
  id           String         @id
  licensePlate String
  ownerId      String
  createdAt    DateTime       @default(now())
  deletedAt    DateTime?
  code         String?
  transactions transactions[]
  owners       owners         @relation(fields: [ownerId], references: [id])
}

model users {
  id           String         @id
  name         String
  username     String         @unique
  password     String
  role         UserRole       @default(STAFF)
  stationId    String?
  createdAt    DateTime       @default(now())
  audit_logs   audit_logs[]
  sessions     sessions[]
  shifts       shifts[]
  transactions transactions[]
  stations     stations?      @relation(fields: [stationId], references: [id])
}

enum DailyRecordStatus {
  OPEN
  CLOSED
}

enum InvoiceStatus {
  PENDING
  PAID
  PARTIAL
}

enum OwnerGroup {
  SUGAR_FACTORY
  GENERAL_CREDIT
  BOX_TRUCK
  OIL_TRUCK
}

enum PaymentType {
  CASH
  CREDIT
  TRANSFER
  BOX_TRUCK
  OIL_TRUCK_SUPACHAI
  CREDIT_CARD
}

enum StationType {
  FULL
  SIMPLE
  GAS
}

enum UserRole {
  ADMIN
  STAFF
}
