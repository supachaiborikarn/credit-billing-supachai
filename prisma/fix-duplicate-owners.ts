import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// à¸£à¸²à¸¢à¸à¸²à¸£à¸Šà¸·à¹ˆà¸­à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸£à¸§à¸¡: oldNames -> newName
const NAME_MAPPINGS = [
    // à¸­à¸µà¸‹à¸¹à¸‹à¸¸à¹€à¸ªà¸™à¸µà¸¢à¸™à¸•à¹Œ
    { newName: 'à¸šà¸ˆà¸.à¸­à¸µà¸‹à¸¹à¸‹à¸¸à¹€à¸ªà¸™à¸µà¸¢à¸™à¸•à¹Œà¸™à¸„à¸£à¸ªà¸§à¸£à¸£à¸„à¹Œ', oldNames: ['à¸šà¸ˆà¸. à¸­à¸µà¸‹à¸¹à¸‹à¸¸à¹€à¸ªà¸™à¸µà¸¢à¸™à¸•à¹Œ'] },

    // à¸­à¸µà¸‹à¸¹à¸‹à¸¸à¸žà¸´à¸ˆà¸´à¸•à¸£
    { newName: 'à¸šà¸ˆà¸.à¸­à¸µà¸‹à¸¹à¸‹à¸¸à¸žà¸´à¸ˆà¸´à¸•à¸£ (1999)', oldNames: ['à¸šà¸ˆà¸. à¸­à¸µà¸‹à¸¹à¸‹à¸¸à¸žà¸´à¸ˆà¸´à¸•à¸£(1999)'] },

    // à¸­à¸µà¸‹à¸¹à¸‹à¸¸à¹€à¸ªà¸µà¸¢à¸‡à¹„à¸žà¸¨à¸²à¸¥
    { newName: 'à¸šà¸ˆà¸.à¸­à¸µà¸‹à¸¹à¸‹à¸¸à¹€à¸ªà¸µà¸¢à¸‡à¹„à¸žà¸¨à¸²à¸¥ à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£', oldNames: ['à¸šà¸ˆà¸.à¸­à¸µà¸‹à¸¹à¸‹à¸¸à¹€à¸ªà¸µà¸¢à¹„à¸žà¸¨à¸²à¸¥ à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£'] },

    // à¹à¸¡à¹‡à¸à¸à¸¹à¹Šà¸”à¸„à¸²à¸£à¹Œ
    { newName: 'à¸šà¸ˆà¸.à¹à¸¡à¹‡à¸à¸à¸¹à¹Šà¸”à¸„à¸²à¸£à¹Œ', oldNames: ['à¸šà¸ˆà¸. à¹à¸¡à¹‡à¸à¸à¸¹à¹‰à¸”à¸„à¸²à¸£à¹Œ', 'à¸šà¸ˆà¸. à¹à¸¡à¹‡à¸à¸à¸¹à¹Šà¸”à¸„à¸²à¸£à¹Œ', 'à¹à¸¡à¹‡à¸à¸à¸¹à¹‰à¸”à¸„à¸²à¸£à¹Œ'] },

    // à¸­.à¸­à¸²à¸£à¸¢à¸°à¸§à¸‡à¸¨à¹Œ
    { newName: 'à¸šà¸ˆà¸.à¸­.à¸­à¸²à¸£à¸¢à¸°à¸§à¸‡à¸¨à¹Œ', oldNames: ['à¸šà¸ˆà¸. à¸­.à¸­à¸²à¸£à¸¢à¸°à¸§à¸‡à¸¨à¹Œ', 'à¸­. à¸­à¸²à¸£à¸¢à¸°à¸§à¸‡à¸¨à¹Œ', 'à¸­.à¸­à¸²à¸¢à¸°à¸§à¸‡à¸¨à¹Œ'] },

    // à¸¡à¸±à¸Šà¸Œà¸´à¸¡à¸²
    { newName: 'à¸šà¸ˆà¸.à¸¡à¸±à¸Šà¸Œà¸´à¸¡à¸² à¸”à¸´à¸ªà¸—à¸£à¸´à¸šà¸´à¸§à¹€à¸•à¸­à¸£à¹Œ', oldNames: ['à¸šà¸ˆà¸. à¸¡à¸±à¸Šà¸Œà¸´à¸¡à¸² à¸”à¸´à¸ªà¸—à¸£à¸´à¸šà¸´à¸§à¹€à¸•à¸­à¸£à¹Œ'] },

    // à¹€à¸„ à¸žà¸µ à¸­à¸­à¸à¸‹à¸´à¹€à¸ˆà¸™
    { newName: 'à¸šà¸ˆà¸.à¹€à¸„ à¸žà¸µ à¸­à¸­à¸à¸‹à¸´à¹€à¸ˆà¸™à¸à¸£à¸¸à¹Šà¸›', oldNames: ['à¸šà¸ˆà¸. à¹€à¸„ à¸žà¸µ à¸­à¸­à¸à¸‹à¸´à¹€à¸ˆà¸™à¸à¸£à¸¸à¹Šà¸›', 'à¸šà¸ˆà¸. à¹€à¸„à¸žà¸µ à¸­à¸­à¸à¸‹à¸´à¹€à¸ˆà¸™à¸à¸£à¸¸à¹Šà¸›', 'à¸šà¸ˆà¸. à¹€à¸„à¸žà¸µà¸­à¹Šà¸­à¸à¸‹à¸´à¹€à¸ˆà¸™'] },

    // à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸®à¸­à¸™à¸”à¹‰à¸²
    { newName: 'à¸šà¸ˆà¸.à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸®à¸­à¸™à¸”à¹‰à¸² (à¸¥à¸¹à¸à¸„à¹‰à¸²)', oldNames: ['à¸šà¸ˆà¸. à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸®à¸­à¸™à¸”à¹‰à¸²(à¸¥à¸¹à¸à¸„à¹‰à¸²)'] },

    // à¸‡à¹ˆà¸§à¸™à¸®à¸‡à¸«à¸¥à¸µ
    { newName: 'à¸«à¸ˆà¸.à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸‡à¹ˆà¸§à¸™à¸®à¸‡à¸«à¸¥à¸µ', oldNames: ['à¸«à¸ˆà¸. à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£à¸‡à¹ˆà¸§à¸™à¸®à¸‡à¸«à¸¥à¸µ'] },

    // à¸‰à¸±à¹ˆà¸§à¸à¸²à¸£à¸Šà¹ˆà¸²à¸‡
    { newName: 'à¸«à¸ˆà¸.à¸‰à¸±à¹ˆà¸§à¸à¸²à¸£à¸Šà¹ˆà¸²à¸‡', oldNames: ['à¸«à¸ˆà¸. à¸‰à¸±à¹ˆà¸§à¸à¸²à¸£à¸Šà¹ˆà¸²à¸‡'] },

    // à¸®à¸±à¹ˆà¸™à¸žà¸‡à¸©à¹Œà¸à¸µà¹ˆ
    { newName: 'à¸«à¸ˆà¸.à¸®à¸±à¹ˆà¸™à¸žà¸‡à¸©à¹Œà¸à¸µà¹ˆ (PEPSI)', oldNames: ['à¸«à¸ˆà¸. à¸®à¸±à¹ˆà¸™à¸žà¸‡à¸©à¹Œà¸à¸µà¹ˆ (PEPSI)'] },

    // à¹‚à¸£à¸‡à¹€à¸£à¸µà¸¢à¸™à¹€à¸‰à¸¥à¸´à¸¡à¸žà¸£à¸°à¹€à¸à¸µà¸¢à¸£à¸•à¸´
    { newName: 'à¹‚à¸£à¸‡à¹€à¸£à¸µà¸¢à¸™à¹€à¸‰à¸¥à¸´à¸¡à¸žà¸£à¸°à¹€à¸à¸µà¸¢à¸£à¸•à¸´', oldNames: ['à¸£.à¸£.à¹€à¸‰à¸¥à¸´à¸¡à¸žà¸£à¸°à¹€à¸à¸µà¸¢à¸£à¸•à¸´', 'à¸£à¸£. à¹€à¸‰à¸¥à¸´à¸¡à¸žà¸£à¸°à¹€à¸à¸µà¸¢à¸£à¸•à¸´', 'à¸£à¸£.à¹€à¸‰à¸¥à¸´à¸¡à¸žà¸£à¸°à¹€à¸à¸µà¸¢à¸£à¸•à¸´', 'à¹‚à¸£à¸‡à¸£à¸µà¸¢à¸™à¹€à¸‰à¸¥à¸´à¸¡à¸žà¸£à¸°à¹€à¸à¸µà¸¢à¸£à¸•à¸´'] },

    // à¸¨à¸¹à¸™à¸¢à¹Œà¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸²à¸žà¸´à¹€à¸¨à¸©
    { newName: 'à¸¨à¸¹à¸™à¸¢à¹Œà¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸²à¸žà¸´à¹€à¸¨à¸©', oldNames: ['à¸¨à¸¸à¸™à¸¢à¹Œà¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸²à¸žà¸´à¹€à¸¨à¸©', 'à¸¨à¸¹à¸™à¸¢à¹Œà¸¨à¸¶à¸à¸©à¸²à¸žà¸´à¹€à¸¨à¸©'] },

    // à¹€à¸­à¹‡à¸¡à¹€à¸­à¹‡à¸¡à¹‚à¸—à¹à¸šà¸„à¹‚à¸„
    { newName: 'à¹€à¸­à¹‡à¸¡à¹€à¸­à¹‡à¸¡à¹‚à¸—à¹à¸šà¸„à¹‚à¸„', oldNames: ['à¹€à¸­à¹‡à¸¡ à¹€à¸­à¹‡à¸¡ à¹‚à¸žà¹à¸šà¸„à¹‚à¸„', 'à¹€à¸­à¹‡à¸¡.à¹€à¸­à¹‡à¸¡.à¹‚à¸—à¹à¸šà¸„à¹‚à¸„', 'à¹€à¸­à¹‡à¸¡à¹€à¸­à¹‡à¸¡ à¹‚à¸—à¹à¸šà¸„à¹‚à¸„'] },

    // à¸¨à¸¸à¸ à¸Šà¸±à¸¢ à¸‡à¸²à¸¡à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸
    { newName: 'à¸¨à¸¸à¸ à¸Šà¸±à¸¢ à¸‡à¸²à¸¡à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸', oldNames: ['à¸¨à¸¸à¸ à¸Šà¸±à¸š à¸‡à¸²à¸¡à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸'] },

    // à¹€à¸Šà¸© à¸žà¸£à¸«à¸¡à¸§à¸´à¸«à¸²à¸£
    { newName: 'à¹€à¸Šà¸© à¸žà¸£à¸«à¸¡à¸§à¸´à¸«à¸²à¸£', oldNames: ['à¹€à¸‹à¸© à¸žà¸£à¸«à¸¡à¸§à¸´à¸«à¸²à¸£'] },

    // à¸£à¸ž.à¹€à¸­à¸à¸Šà¸™
    { newName: 'à¸£à¸ž.à¹€à¸­à¸à¸Šà¸™à¹€à¸¡à¸·à¸­à¸‡à¸à¸³à¹à¸žà¸‡', oldNames: ['à¸£à¸ž. à¹€à¸­à¸à¸Šà¸™à¹€à¸¡à¸·à¸­à¸‡à¸à¸³à¹à¸žà¸‡à¹€à¸žà¸Šà¸£'] },

    // à¸¡à¸´à¸•à¸£à¹€à¸à¸©à¸•à¸£
    { newName: 'à¸¡à¸´à¸•à¸£à¹€à¸à¸©à¸•à¸£ à¸­à¸¸à¸—à¸±à¸¢à¸˜à¸²à¸™à¸µ', oldNames: ['à¸¡à¸´à¸•à¸£à¹€à¸à¸©à¸•à¸£(à¸­à¸¸à¸—à¸±à¸¢)', 'à¸¡à¸´à¸•à¸£à¹€à¸à¸©à¸•à¸£'] },

    // à¸›.à¸ªà¸¢à¸²à¸¡
    { newName: 'à¸›.à¸ªà¸¢à¸²à¸¡à¸‚à¸™à¸ªà¹ˆà¸‡', oldNames: ['à¸›.à¸ªà¸¢à¸²à¸¡'] },

    // à¸žà¸‡à¸©à¹Œà¸œà¸à¸²
    { newName: 'à¸«à¸ˆà¸.à¸žà¸‡à¸©à¹Œà¸œà¸à¸²à¸‚à¸™à¸ªà¹ˆà¸‡', oldNames: ['à¸žà¸‡à¸©à¹Œà¸œà¸à¸²à¸‚à¸™à¸ªà¹ˆà¸‡'] },
];

async function main() {
    console.log('ðŸ”„ à¸à¸³à¸¥à¸±à¸‡à¸£à¸§à¸¡à¸Šà¸·à¹ˆà¸­ Owner à¸—à¸µà¹ˆà¸‹à¹‰à¸³à¸à¸±à¸™...\n');

    let totalMerged = 0;
    let totalDeleted = 0;

    for (const { newName, oldNames } of NAME_MAPPINGS) {
        // à¸«à¸² Owner à¸—à¸µà¹ˆà¸ˆà¸°à¹€à¸à¹‡à¸šà¹„à¸§à¹‰ (newName)
        const targetOwner = await prisma.owner.findFirst({
            where: { name: newName }
        });

        if (!targetOwner) {
            console.log(`âš ï¸ à¹„à¸¡à¹ˆà¸žà¸š "${newName}" à¸‚à¹‰à¸²à¸¡à¹„à¸›...`);
            continue;
        }

        for (const oldName of oldNames) {
            // à¸«à¸² Owner à¸—à¸µà¹ˆà¸ˆà¸°à¸¥à¸š
            const oldOwner = await prisma.owner.findFirst({
                where: { name: oldName }
            });

            if (!oldOwner) continue;

            // à¸¢à¹‰à¸²à¸¢ trucks à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹„à¸›à¸¢à¸±à¸‡ target owner
            const trucksUpdated = await prisma.truck.updateMany({
                where: { ownerId: oldOwner.id },
                data: { ownerId: targetOwner.id }
            });

            if (trucksUpdated.count > 0) {
                console.log(`  âœ… à¸¢à¹‰à¸²à¸¢ ${trucksUpdated.count} à¸£à¸– à¸ˆà¸²à¸ "${oldName}" â†’ "${newName}"`);
                totalMerged += trucksUpdated.count;
            }

            // à¸¥à¸š Owner à¹€à¸à¹ˆà¸²
            await prisma.owner.delete({
                where: { id: oldOwner.id }
            });
            console.log(`  ðŸ—‘ï¸ à¸¥à¸š Owner: "${oldName}"`);
            totalDeleted++;
        }
    }

    console.log(`\nðŸŽ‰ à¸£à¸§à¸¡ ${totalMerged} à¸£à¸–, à¸¥à¸š ${totalDeleted} Owner à¸‹à¹‰à¸³!`);

    // à¹à¸ªà¸”à¸‡à¸ˆà¸³à¸™à¸§à¸™ Owner à¸—à¸µà¹ˆà¹€à¸«à¸¥à¸·à¸­
    const remainingCount = await prisma.owner.count();
    console.log(`ðŸ“Š Owner à¸—à¸µà¹ˆà¹€à¸«à¸¥à¸·à¸­à¹ƒà¸™à¸£à¸°à¸šà¸š: ${remainingCount} à¸£à¸²à¸¢`);
}

main()
    .catch((e) => {
        console.error('âŒ Error:', e);
        process.exit(1);
    })
    .finally(async () => {
        await prisma.$disconnect();
    });
